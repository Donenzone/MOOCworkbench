{% extends 'base.html' %}
{% load bootstrap %}
{% load comments %}
{% block content %}

<div class="container">
  <div class="row">
    <div class="col-md-9">
      <h2>View Package: {{ object.package_name }}</h2>
    </div>

      <div class="col-md-3">
        {% if not workbench_user in object.subscribed_users.all %}
          <a href="{% url 'package_subscribe' object.pk %}" class="btn btn-default">Subscribe for updates</a>
        {% else %}
          <a href="{% url 'package_subscribe' object.pk %}">Unsubscribe</a>
        {% endif %}
      </div>
  </div>
  <div class="col-md-6">
  <h3>General information</h3>
    <table class="table table-bordered">
      <tr>
        <td>Description</td>
        <td>{{ object.description }}
      </tr>
      <tr>
        <td>Project page</td>
        <td>{{ object.project_page }}
      </tr>
      <tr>
        <td>Added at</td>
        <td>{{ object.created }}
      </tr>
    </table>
  </div>
  <div class="col-md-6">
  <h3>Version history</h3>
  <table class="table table-bordered">
    <tr>
      <th>Version nr</th>
      <th>Date added</th>
      <th>Changelog</th>
    </tr>
    {% for version in version_history %}
    <tr>
      <td>
        {{ version.version_nr }}
      </td>
      <td>
        {{ version.created }}
      </td>
      <td>
        {{ version.changelog }}
      </td>
    </tr>
    {% endfor %}
  </table>
  <a href="{% url 'packageversion_new' object.pk %}" class="btn btn-default">Add New Version</a>
  </div>
</div>
<h3>Package resources</h3>
<a href="#">View all resources for this package</a>
{% for resource in resources %}
  {{ resource.resource }} at <a href="{{ resource.url }}">{{ resource.url }}</a>
{% endfor %}

<p>Found a useful blog, website or other information that you wish to share with others?</p>
<p><a href="{% url 'packageresource_new' object.pk %}" class="btn btn-default">Add a New Resource</a></p>

<hr />

<h3>Comments</h3>
{% get_comment_form for object as comment_form %}
<div class="container" style="margin-bottom:20px">
  <div class="col-md-2">
    <form action="{% comment_form_target %}" method="POST">
      {% csrf_token %}
      <div class="form-group">
        <label class="control-label" for="id_comment">Comment</label>
        <textarea class="form-control" id="id_comment" maxlength="300" style="width:300px" name="comment" rows="5" required=""></textarea>
      </div>
      {{ comment_form.content_type }}
      {{ comment_form.object_pk }}
      {{ comment_form.timestamp }}
      {{ comment_form.security_hash }}
      <input type="submit" name="submit" value="Post" class="btn btn-primary">
    </form>
  </div>
</div>

<div class="container">
{% get_comment_list for object as comment_list %}
{% for comment in comment_list %}
  <div class="row">
    <div class="col-sm-1">
      <div class="thumbnail">
      <img class="img-responsive user-photo" src="https://ssl.gstatic.com/accounts/ui/avatar_2x.png">
      </div><!-- /thumbnail -->
    </div><!-- /col-sm-1 -->

    <div class="col-sm-5">
      <div class="panel panel-default">
        <div class="panel-heading">
          <strong>{{ comment.user }}</strong> <span class="text-muted">{{ comment.submit_date }}</span>
        </div>
        <div class="panel-body">
          {{ comment.comment }}
        </div><!-- /panel-body -->
      </div><!-- /panel panel-default -->
    </div><!-- /col-sm-5 -->
  </div>
{% endfor %}
</div>
{% endblock %}
